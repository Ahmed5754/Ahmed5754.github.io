<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تمرين الكتابة الاحترافي</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark-1: #1d2b34;
            --bg-dark-2: #1c262c;
            --container-dark: #28343c;
            --text-primary: #cdd8e0;
            --text-faint: #667988;
            --primary-accent: #52a3dd;
            --correct-color: #7acc7a;
            --incorrect-color: #e0707c;
        }
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes pop {
            0% { transform: translateY(0); }
            50% { transform: translateY(-3px); color: #fff;}
            100% { transform: translateY(0); }
        }
        body {
            font-family: 'Amiri', serif;
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background: linear-gradient(-45deg, var(--bg-dark-1), var(--bg-dark-2), #2a3a46, #1c2a34);
            background-size: 400% 400%;
            animation: gradient-animation 25s ease infinite;
            transition: background-color 0.3s;
        }
        .main-container {
            width: 90%;
            max-width: 900px;
            background: rgba(40, 52, 60, 0.85);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #3c4953;
            position: relative;
        }
        #generator-container { text-align: center; border-bottom: 1px solid var(--text-faint); padding-bottom: 20px; margin-bottom: 20px; }
        #generator-container h3 { margin-top: 0; margin-bottom: 20px; color: #fff; font-weight: 700; }
        
        .difficulty-btn, #start-custom-btn, #retry-btn {
            padding: 10px 18px; font-size: 16px; font-family: inherit; cursor: pointer;
            border-radius: 8px; border: 1px solid #4b5a67; background-color: #3a454f; color: var(--text-primary);
            margin: 5px; transition: all 0.2s ease-in-out; display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .difficulty-btn:hover, #start-custom-btn:hover, #retry-btn:hover {
            background-color: var(--primary-accent); border-color: var(--primary-accent);
            color: #fff; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(82, 163, 221, 0.2);
        }
        .difficulty-btn svg { width: 18px; height: 18px; }
        
        #custom-text-container { margin-top: 20px; padding: 15px; background-color: #212a30; border-radius: 8px; }
        #custom-textarea { width: 95%; height: 100px; padding: 10px; font-size: 16px; font-family: inherit; border-radius: 5px; border: 1px solid #4b5a67; background-color: #28343c; color: var(--text-primary); margin-bottom: 10px; }
        #custom-textarea:focus { outline: none; border-color: var(--primary-accent); }
        .hidden { display: none !important; }
        
        #stats-container { display: flex; justify-content: space-around; margin-bottom: 25px; padding: 15px; background: #212a30; border-radius: 8px; font-size: 18px; }
        #stats-container div { text-align: center; color: #fff; }
        #stats-container span { font-weight: 700; font-size: 24px; color: var(--primary-accent); min-width: 40px; display: inline-block; }
        
        #text-display-wrapper { position: relative; }
        #text-display { font-size: 32px; line-height: 2.2; letter-spacing: 2px; background-color: #212a30; padding: 25px; border-radius: 8px; min-height: 180px; margin-bottom: 20px; text-align: justify; }
        .char-pop { animation: pop 0.2s ease; }
        .char { color: var(--text-faint); transition: color 0.3s ease, background-color 0.3s ease; }
        .char.correct { color: var(--correct-color); }
        .char.incorrect { color: var(--incorrect-color); background-color: rgba(224, 112, 124, 0.15); }
        .char.active { background-color: var(--text-faint); border-radius: 3px; color: var(--container-dark); }

        #countdown-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(28, 38, 44, 0.95); z-index: 10;
            display: flex; justify-content: center; align-items: center;
            font-size: 120px; color: var(--primary-accent); font-weight: 700;
            border-radius: 15px;
        }
        #retry-btn { margin: 0 auto; font-size: 16px; }
        
    </style>
</head>
<body>

<div class="main-container">
    <div id="generator-container">
         <h3>أنشئ تمريناً جديداً</h3>
        <button class="difficulty-btn" data-difficulty="easy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>سهل</button>
        <button class="difficulty-btn" data-difficulty="medium"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l2.35 7.16h7.65l-6.18 4.48 2.35 7.16-6.17-4.48-6.17 4.48 2.35-7.16-6.18-4.48h7.65z"/></svg>متوسط</button>
        <button class="difficulty-btn" data-difficulty="hard"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>صعب</button>
        <button class="difficulty-btn" data-difficulty="mediumFormatted"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>مع تشكيل</button>
        <button id="custom-text-btn" class="difficulty-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>نص مخصص</button>
    </div>

    <div id="custom-text-container" class="hidden">
        <textarea id="custom-textarea" placeholder="ضع النص الذي تريد التدرب عليه هنا..."></textarea>
        <button id="start-custom-btn">ابدأ التمرين</button>
    </div>

    <div id="stats-container">
        <div>السرعة<br><span id="wpm">0</span></div>
        <div>الدقة<br><span id="accuracy">100</span>%</div>
        <div>الوقت<br><span id="timer">0</span> ث</div>
    </div>
    
    <div id="text-display-wrapper">
        <div id="countdown-overlay" class="hidden">
            <span id="countdown-text">3</span>
        </div>
        <div id="text-display">اضغط على أحد الأزرار أعلاه لبدء التمرين...</div>
        <button id="retry-btn" class="hidden">
            إعادة التمرين
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M21 21v-5h-5"/></svg>
        </button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const textBank = {
        easy: ["كان هناك أرنب سريع جداً يتباهى بسرعته أمام السلحفاة البطيئة. قررا أن يتسابقا. نام الأرنب في منتصف الطريق وفازت السلحفاة.","الصدق هو أقصر طريق إلى راحة البال. كن صادقاً في أقوالك وأفعالك دائماً. القليل من الصدق خير من الكثير من الكلام المعسول."],
        medium: ["في عالم التكنولوجيا، يتغير كل شيء بسرعة فائقة. ما كان يعتبر ابتكاراً بالأمس، قد يصبح قديماً اليوم. لذلك، يجب على الإنسان أن يظل متعلماً ومطلعاً على كل جديد حتى لا يفوته قطار التقدم والتطور المستمر في مجتمعه.","تعتبر القراءة نافذة نطل بها على عوالم لم نرها وأزمنة لم نعشها. إنها توسع مداركنا وتثري مفرداتنا وتصقل شخصياتنا. اجعل الكتاب صديقك الدائم في كل مراحل حياتك."],
        mediumFormatted: ["يُعَدُّ الْعِلْمُ نُورًا يُضِيءُ لِلْإِنْسَانِ طَرِيقَهُ، وَيَهْدِيهِ إِلَى سُبُلِ الْخَيْرِ وَالرَّشَادِ. بِالْعِلْمِ تَرْتَقِي الْأُمَمُ، وَتَبْنِي حَضَارَاتِهَا الْعَظِيمَةَ. فَاحْرِصْ، يَا بُنَيَّ، عَلَى طَلَبِ الْعِلْمِ.","الصِّدْقُ مَنْجَاةٌ، وَالْكَذِبُ مَهْوَاةٌ. قَدْ يَحْسَبُ الْكَإذِبُ أَنَّهُ يُنْقِذُ نَفْسَهُ، وَلَكِنَّ حَبْلَ الْكَذِبِ قَصِيرٌ. أَمَّا الصَّادِقُ، فَهُوَ مُطْمَئِنُّ الْبَالِ، وَاثِقُ الْخُطَى."],
        hard: ["تاريخ البشرية هو قصة طويلة من الصراع والتحدي، ولكنه أيضاً قصة من الإبداع والابتكار الذي لا ينضب. منذ أن أشعل الإنسان ناره الأولى ورسم على جدران الكهوف، وهو يسعى جاهداً لفهم العالم من حوله وتسخير الطبيعة لخدمته. مرت الحضارات كالأمواج، ترتفع لتصل إلى قمم المجد ثم تنحسر تاركة وراءها آثاراً تدل على عظمتها من أهرامات شاهقة إلى مخطوطات نادرة. إن دراسة هذا التاريخ تعلمنا أن التقدم لم يكن يوماً سهلاً، بل كان ثمرة لجهود أجيال متواصلة من المفكرين والعمال والفنانين الذين آمنوا بمستقبل أفضل.","تعد الاستدامة البيئية واحدة من أكبر التحديات التي تواجه عالمنا المعاصر. إن النمو الصناعي والسكاني الهائل قد وضع ضغوطاً غير مسبوقة على موارد كوكبنا المحدودة، من المياه العذبة والغابات إلى الهواء النقي الذي نتنفسه. لم يعد من الممكن تجاهل عواقب أفعالنا، مثل تغير المناخ وفقدان التنوع البيولوجي. يتطلب الأمر تحولاً جذرياً في طريقة تفكيرنا وسلوكنا، بالانتقال من نموذج الاستهلاك الخطي إلى نموذج الاقتصاد الدائري الذي يركز على إعادة الاستخدام والتدوير وتقليل النفايات إلى الحد الأدنى. إنها مسؤولية جماعية تقع على عاتق الحكومات والشركات والأفراد على حد سواء."],
        hardFormatted: ["الْلُّغَةُ الْعَرَبِيَّةُ بَحْرٌ عَمِيقٌ، لَا يَصِلُ إِلَى قَعْرِهِ إِلَّا الْغَوَّاصُونَ الْمَاهِرُونَ. تَزْخَرُ بِمُفْرَدَاتٍ ثَرِيَّةٍ وَتَرَاكِيبَ بَلَاغِيَّةٍ أَخَّاذَةٍ، وَتَتَمَيَّزُ بِقُدْرَتِهَا الْفَائِقَةِ عَلَى الْتَّعْبِيرِ عَنْ أَدَقِّ الْأَفْكَارِ وَأَرْقَى الْمَشَاعِرِ. إِنَّ إِتْقَانَهَا لَيْسَ مُجَرَّدَ مَهَارَةٍ لُغَوِيَّةٍ، بَلْ هُوَ غَوْصٌ فِي تَارِيخٍ عَظِيمٍ وَثَقَافَةٍ أَصِيلَةٍ. فَالْحَرْفُ الْعَرَبِيُّ يَحْمِلُ فِي طَيَّاتِهِ إِرْثًا يَمْتَدُّ لِقُرُونٍ طَوِيلَةٍ، مِنَ الشِّعْرِ الْجَاهِلِيِّ الْفَصِيحِ إِلَى آيَاتِ الْقُرْآنِ الْكَرِيمِ الْبَيِّنَةِ، مِمَّا يَجْعَلُهَا لُغَةً حَيَّةً تَنْبِضُ بِالْجَمَالِ وَالْجَلَالِ.","الْأَمَانَةُ خُلُقٌ عَظِيمٌ وَرُكْنٌ أَسَاسِيٌّ فِي بِنَاءِ الْمُجْتَمَعَاتِ الْمُتَمَاسِكَةِ. لَيْسَتِ الْأَمَانَةُ مُقْتَصِرَةً عَلَى حِفْظِ الْوَدَائِعِ الْمَالِيَّةِ فَحَسْبُ، بَلْ تَتَعَدَّاهَا لِتَشْمَلَ الْإِخْلَاصَ فِي الْعَمَلِ، وَالْصِّدْقَ فِي الْقَوْلِ، وَالْحِفَاظَ عَلَى الْأَسْرَارِ، وَأَدَاءَ كُلِّ حَقٍّ إِلَى صَاحِبِهِ. إِنَّ الْإِنْسَانَ الْأَمِينَ هُوَ شَخْصٌ مَوْثُوقٌ بِهِ، يَطْمَئِنُّ النَّاسُ إِلَيْهِ وَيَعْتَمِدُونَ عَلَيْهِ فِي شُؤُونِهِمُ الْهَامَّةِ. وَبِدُونِ الْأَمَانَةِ، تَسُودُ الْفَوْضَى وَيَنْعَدِمُ الْاسْتِقْرَارُ، وَتَتَفَكَّكُ أَوْصَالُ الثِّقَةِ بَيْنَ أَفْرَادِ الْأُمَّةِ الْوَاحِدَةِ."]
    };
    
    const textDisplayEl = document.getElementById('text-display');
    const wpmEl = document.getElementById('wpm');
    const accuracyEl = document.getElementById('accuracy');
    const timerEl = document.getElementById('timer');
    const customTextContainer = document.getElementById('custom-text-container');
    const customTextarea = document.getElementById('custom-textarea');
    const countdownOverlay = document.getElementById('countdown-overlay');
    const countdownTextEl = document.getElementById('countdown-text');
    const retryBtn = document.getElementById('retry-btn');

    let currentIndex = 0;
    let correctChars = 0;
    let totalTyped = 0;
    let timerInterval;
    let startTime;
    let currentText = "";
    let isTypingEnabled = false;

    document.querySelectorAll('.difficulty-btn').forEach(button => {
        button.addEventListener('click', () => {
            customTextContainer.classList.add('hidden');
            if (button.id === 'custom-text-btn') {
                customTextContainer.classList.toggle('hidden');
                return;
            }
            const difficulty = button.dataset.difficulty;
            const texts = textBank[difficulty];
            currentText = texts[Math.floor(Math.random() * texts.length)];
            loadText(currentText);
        });
    });

    document.getElementById('start-custom-btn').addEventListener('click', () => {
        const customTxt = customTextarea.value;
        if (customTxt.trim() !== "") {
            currentText = customTxt;
            loadText(currentText);
            customTextContainer.classList.add('hidden');
        } else { alert("الرجاء إدخال نص للتدرب عليه."); }
    });

    retryBtn.addEventListener('click', () => {
        loadText(currentText);
    });

    function loadText(text) {
        resetState();
        textDisplayEl.innerHTML = '';
        text.split('').forEach(char => {
            const charSpan = document.createElement('span');
            charSpan.innerText = char;
            charSpan.classList.add('char');
            textDisplayEl.appendChild(charSpan);
        });
        startCountdown();
    }
    
    function startCountdown() {
        countdownOverlay.classList.remove('hidden');
        let count = 3;
        countdownTextEl.textContent = count;
        const countdownInterval = setInterval(() => {
            count--;
            if (count > 0) {
                countdownTextEl.textContent = count;
            } else {
                clearInterval(countdownInterval);
                countdownOverlay.classList.add('hidden');
                isTypingEnabled = true;
                if(textDisplayEl.querySelectorAll('.char').length > 0) {
                   textDisplayEl.querySelectorAll('.char')[0].classList.add('active');
                }
            }
        }, 1000);
    }

    function resetState() {
        isTypingEnabled = false;
        clearInterval(timerInterval);
        timerInterval = null;
        currentIndex = 0;
        correctChars = 0;
        totalTyped = 0;
        wpmEl.textContent = '0';
        accuracyEl.textContent = '100';
        timerEl.textContent = '0';
        retryBtn.classList.add('hidden');
    }

    function handleTyping(e) {
        if (!isTypingEnabled || e.key === 'Shift' || e.key === 'Control' || e.key === 'Alt' || e.key === 'Meta' || e.key === 'Backspace') return;
        
        const charSpans = textDisplayEl.querySelectorAll('.char');
        if (currentIndex >= charSpans.length) return;

        if (!timerInterval && totalTyped === 0) {
            startTime = new Date();
            timerInterval = setInterval(updateStats, 1000);
        }
        
        charSpans[currentIndex].classList.remove('active');
        totalTyped++;
        
        if (e.key === charSpans[currentIndex].innerText) {
            charSpans[currentIndex].classList.add('correct');
            charSpans[currentIndex].classList.add('char-pop');
            setTimeout(() => {
                if(charSpans[currentIndex]) charSpans[currentIndex].classList.remove('char-pop');
            }, 200);
            correctChars++;
        } else {
            charSpans[currentIndex].classList.add('incorrect');
        }

        currentIndex++;
        updateStats();

        if (currentIndex === charSpans.length) {
            isTypingEnabled = false;
            clearInterval(timerInterval);
            retryBtn.classList.remove('hidden');
        } else {
            charSpans[currentIndex].classList.add('active');
        }
    }
    document.addEventListener('keydown', handleTyping);

    function updateStats() {
        const elapsedTime = startTime ? (new Date() - startTime) / 1000 : 0;
        timerEl.textContent = Math.floor(elapsedTime);
        const minutes = elapsedTime / 60;
        const wpm = minutes > 0 ? Math.round((correctChars / 5) / minutes) : 0;
        wpmEl.textContent = wpm;
        const accuracy = totalTyped > 0 ? Math.round((correctChars / totalTyped) * 100) : 100;
        accuracyEl.textContent = accuracy;
    }
});
</script>

</body>
</html>
