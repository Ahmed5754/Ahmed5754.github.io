<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تمرين الكتابة الاحترافي</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark-1: #1d2b34;
            --bg-dark-2: #1c262c;
            --container-dark: #28343c;
            --text-primary: #cdd8e0;
            --text-faint: #667988;
            --primary-accent: #52a3dd;
            --correct-color: #7acc7a;
            --incorrect-color: #e0707c;
            --highlight-color: #ffc107;
            --transition-speed: 0.3s;
        }
        
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body {
            font-family: 'Amiri', serif;
            font-display: swap;
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background: linear-gradient(-45deg, var(--bg-dark-1), var(--bg-dark-2), #2a3a46, #1c2a34);
            background-size: 400% 400%;
            animation: gradient-animation 25s ease infinite;
            box-sizing: border-box;
        }
        .main-container {
            width: 90%;
            max-width: 900px;
            background: rgba(40, 52, 60, 0.85);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #3c4953;
            position: relative;
        }

        #mode-selection-container { text-align: center; padding: 20px 0; }
        .mode-btn {
             padding: 15px 30px; font-size: 20px; font-family: inherit; cursor: pointer;
            border-radius: 8px; border: 1px solid #4b5a67; background-color: #3a454f; color: var(--text-primary);
            margin: 10px; transition: all 0.2s ease-in-out;
        }
        .mode-btn:hover {
            background-color: var(--primary-accent); border-color: var(--primary-accent);
            color: #fff; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(82, 163, 221, 0.2);
        }

        #levels-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 15px; padding: 20px; background-color: #212a30;
            border-radius: 8px; max-height: 350px; overflow-y: auto;
        }
        /* Custom Scrollbar For Webkit Browsers (Chrome, Safari) */
        #levels-container::-webkit-scrollbar {
            width: 10px;
        }
        #levels-container::-webkit-scrollbar-track {
            background: var(--bg-dark-2);
            border-radius: 10px;
        }
        #levels-container::-webkit-scrollbar-thumb {
            background-color: #4b5a67;
            border-radius: 10px;
            border: 2px solid var(--bg-dark-2);
        }
        #levels-container::-webkit-scrollbar-thumb:hover {
            background-color: var(--primary-accent);
        }
        /* Custom Scrollbar for Firefox */
        #levels-container {
            scrollbar-width: thin;
            scrollbar-color: #4b5a67 var(--bg-dark-2);
        }

        .level-btn {
            padding: 15px; font-size: 20px; font-weight: bold; cursor: pointer;
            border-radius: 8px; border: 1px solid #4b5a67; background-color: #3a454f;
            color: var(--text-faint);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease-in-out;
        }
        .level-btn.unlocked { background-color: #4a5a67; color: var(--text-primary); }
        .level-btn.unlocked:hover { transform: translateY(-3px); background-color: var(--primary-accent); color: #fff; }
        .level-btn.completed { background-color: var(--correct-color); color: #fff; border-color: #5a9d5a; }
        .level-btn.current { background-color: var(--primary-accent); color: #fff; border-color: #4a91c8; box-shadow: 0 0 15px rgba(82, 163, 221, 0.4); }
        .level-btn:disabled { cursor: not-allowed; opacity: 0.5; }
        
        #levels-summary-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #212a30;
            border-radius: 8px;
        }
        .summary-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .summary-progress-bar-container {
            width: 100%;
            background-color: #3a454f;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        #summary-progress-bar-fill {
            height: 100%;
            width: 0%;
            background-color: var(--correct-color);
            border-radius: 5px;
            transition: width 0.5s ease-out;
        }
        #summary-percentage {
            display: block;
            text-align: center;
            margin-top: 5px;
            font-size: 14px;
            color: var(--text-faint);
            font-weight: bold;
        }

        #generator-container { text-align: center; border-bottom: 1px solid var(--text-faint); padding-bottom: 20px; margin-bottom: 20px; }
        #generator-container h3 { margin-top: 0; margin-bottom: 20px; color: #fff; font-weight: 700; }
        
        .difficulty-btn, #start-custom-btn, #retry-btn, .back-btn {
            padding: 10px 18px; font-size: 16px; font-family: inherit; cursor: pointer;
            border-radius: 8px; border: 1px solid #4b5a67; background-color: #3a454f; color: var(--text-primary);
            margin: 5px; transition: all 0.2s ease-in-out; display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .difficulty-btn:hover, #start-custom-btn:hover, #retry-btn:hover, .back-btn:hover {
            background-color: var(--primary-accent); border-color: var(--primary-accent);
            color: #fff; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(82, 163, 221, 0.2);
        }
        
        #custom-text-container { margin-top: 20px; padding: 15px; background-color: #212a30; border-radius: 8px; }
        #custom-textarea { width: 95%; height: 100px; padding: 10px; font-size: 16px; font-family: inherit; border-radius: 5px; border: 1px solid #4b5a67; background-color: var(--container-dark); color: var(--text-primary); margin-bottom: 10px; }
        #custom-textarea:focus { outline: none; border-color: var(--primary-accent); }
        
        .hidden { display: none !important; }

        #stats-container { display: flex; flex-wrap: wrap; justify-content: space-around; margin-bottom: 15px; padding: 10px; background: #212a30; border-radius: 8px; font-size: 18px; }
        #stats-container > div { text-align: center; color: #fff; padding: 5px 10px;}
        #stats-container span { font-weight: 700; font-size: 24px; color: var(--primary-accent); min-width: 40px; display: inline-block; }
        
        #high-score-display {
            width: 100%; text-align: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--text-faint); font-size: 16px; color: var(--highlight-color);
        }
        
        #text-display-wrapper { position: relative; }
        #text-display { 
            font-size: 30px; line-height: 2.1; letter-spacing: 2px; 
            background-color: #212a30; padding: 25px; border-radius: 8px; 
            min-height: 180px; margin-bottom: 20px; text-align: justify;
            position: relative;
        }
        .char { color: var(--text-faint); transition: color 0.3s ease, background-color 0.3s ease; position: relative; }
        .char.correct { color: var(--correct-color); }
        .char.incorrect { color: var(--incorrect-color); background-color: rgba(224, 112, 124, 0.15); }
        .char.active { background-color: rgba(82, 163, 221, 0.3); border-radius: 3px; color: #fff; }

        #blinking-cursor {
            position: absolute; width: 3px; background-color: var(--primary-accent);
            opacity: 0; pointer-events: none; animation: blink 1s infinite steps(1, end);
            transition: left 0.05s linear, top 0.05s linear; border-radius: 1px; z-index: 5;
        }

        #game-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(28, 38, 44, 0.95); z-index: 10; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            text-align: center;
            font-size: 50px; color: var(--primary-accent); font-weight: 700; 
            border-radius: 15px;
            transition: opacity 0.5s ease-in-out;
        }
        #game-overlay h2 { margin: 0; }
        #game-overlay p { font-size: 22px; margin: 10px 0 20px 0; color: var(--text-primary); }
        .overlay-btn { padding: 12px 25px; font-size: 18px; margin: 5px; }

        #progress-bar-container { 
            width: 100%; background-color: #3a454f; height: 12px;
            border-radius: 6px; margin-top: 15px; overflow: hidden;
        }
        #progress-bar-fill { 
            height: 100%; width: 0%; background-color: var(--primary-accent); 
            border-radius: 6px; transition: width 0.1s linear;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        #progress-percentage {
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 0 5px;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s;
        }

        #retry-btn { margin: 10px 5px 0; font-size: 16px; }
        
        #error-analysis-display { 
            margin-top: 20px; padding: 15px; background-color: #212a30; border-radius: 8px;
            max-height: 300px; overflow-y: auto;
        }
        #error-analysis-display h4 { margin: 0 0 10px 0; text-align: center; color: var(--highlight-color); }
        #error-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
        .error-item { 
            background-color: #3a454f; padding: 8px 12px; border-radius: 5px; font-size: 16px;
            width: 100%; text-align: right; line-height: 1.6;
        }
        .error-item .char-name { font-weight: bold; color: var(--incorrect-color); font-size: 20px; }
    </style>
</head>
<body>

<div class="main-container">

    <div id="mode-selection-container">
        <h1>اختر نمط التدرب</h1>
        <button id="levels-mode-btn" class="mode-btn">نمط المراحل</button>
        <button id="practice-mode-btn" class="mode-btn">النمط الحر (تدريب)</button>
    </div>

    <div id="levels-mode-screen" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">اختر مرحلة</h2>
            <button id="levels-back-btn" class="back-btn">العودة</button>
        </div>
        <div id="levels-summary-container">
            <div class="summary-text">
                <span>المراحل المنجزة: <span id="completed-levels">0</span></span>
                <span>المراحل المتبقية: <span id="remaining-levels">0</span></span>
            </div>
            <div class="summary-progress-bar-container">
                <div id="summary-progress-bar-fill"></div>
            </div>
            <span id="summary-percentage">0%</span>
        </div>
        <div id="levels-container"></div>
    </div>
    
    <div id="practice-mode-screen" class="hidden">
        <div id="generator-container"></div>
        <div id="custom-text-container" class="hidden">
            <textarea id="custom-textarea" placeholder="ضع النص الذي تريد التدرب عليه هنا..."></textarea>
            <button id="start-custom-btn">ابدأ التمرين</button>
        </div>
        <button id="practice-back-btn" class="back-btn" style="margin-top: 15px;">العودة</button>
    </div>

    <div id="typing-interface" class="hidden">
        <div id="stats-container">
            <div>السرعة<br><span id="wpm">0</span></div>
            <div>الدقة<br><span id="accuracy">100</span>%</div>
            <div><span id="timer-label">الوقت</span><br><span id="timer">0</span> ث</div>
            <div id="high-score-display" class="hidden"></div>
        </div>
        
        <div id="text-display-wrapper">
            <div id="game-overlay" class="hidden">
                <h2 id="overlay-title"></h2>
                <p id="overlay-message"></p>
                <div id="overlay-buttons"></div>
            </div>
            <div id="text-display"></div>
            <span id="blinking-cursor"></span>
            <div id="progress-bar-container">
                <div id="progress-bar-fill">
                    <span id="progress-percentage">0%</span>
                </div>
            </div>
            <div style="text-align: center; margin-top: 10px;">
                <button id="typing-back-btn" class="back-btn">العودة للخلف</button>
                <button id="main-menu-btn" class="back-btn">القائمة الرئيسية</button>
                <button id="retry-btn" class="hidden">إعادة</button>
            </div>
            <div id="error-analysis-display" class="hidden">
                <h4>أكثر الأخطاء شيوعاً</h4>
                <div id="error-list"></div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // ========= DATA BANKS (PRACTICE & LEVELS) ========= //
    const textBank = {
        easy: ["كان النبي محمد صلى الله عليه وسلم معروفاً بصدقه وأمانته منذ صغره، حتى أن أهل مكة كانوا يلقبونه بالصادق الأمين ويأتمنونه على أموالهم.", "يتكون نظامنا الشمسي من الشمس وثمانية كواكب تدور حولها. كوكبنا الأرض هو الكوكب الثالث من حيث البعد عن الشمس، وهو المكان الوحيد الذي نعرف أن به حياة.", "عندما نزل الوحي على الرسول لأول مرة في غار حراء، عاد إلى زوجته خديجة رضي الله عنها خائفاً يرتجف، فطمأنته وقالت له: والله لا يخزيك الله أبداً.", "النجوم التي نراها في الليل هي شموس عملاقة لكنها بعيدة جداً عنا. أقرب نجم إلينا بعد الشمس يسمى بروكسيما سنتوري ويبعد عنا أكثر من أربع سنوات ضوئية.", "من حكمة النبي صلى الله عليه وسلم أنه كان يستشير أصحابه في الأمور الهامة. في معركة أحد، أخذ برأي غالبية الصحابة بالخروج لملاقاة العدو خارج المدينة.", "الماء ضروري جداً للحياة على كوكب الأرض. جسم الإنسان يتكون من حوالي 60% من الماء، ونحن نحتاج إلى شرب كمية كافية منه يومياً للحفاظ على صحتنا ووظائف أعضائنا."],
        medium: ["في بداية الدعوة الإسلامية، تحمل المسلمون الأوائل أذى كبيراً من كفار قريش. ورغم التعذيب والاضطهاد، إلا أنهم ثبتوا على دينهم وصبروا إيماناً بالله ورسوله. كان بلال بن رباح مثالاً عظيماً على الصبر، حيث كان يردد 'أحدٌ أحد' وهو تحت العذاب.", "كوكب المشتري هو أكبر كواكب المجموعة الشمسية، وهو عملاق غازي ضخم جداً حتى أنه يمكن أن يتسع لجميع كواكب النظام الشمسي الأخرى بداخله. يتميز ببقعته الحمراء العظيمة، وهي عاصفة هائلة مستمرة منذ مئات السنين وحجمها أكبر من حجم كوكب الأرض.", "كان الرسول صلى الله عليه وسلم رحيماً بالأطفال، يلاعبهم ويمازحهم. مر يوماً بصبي كان له عصفور صغير يلعب به فمات العصفور، فحزن الصبي. فذهب إليه النبي يواسيه ويقول له مازحاً: 'يا أبا عمير، ما فعل النغير؟'.", "مجرة درب التبانة هي مجرتنا التي نعيش فيها، وهي تحتوي على مئات المليارات من النجوم، بما في ذلك شمسنا. تبدو في السماء كشريط لبني باهت، ومن هنا جاء اسمها. يستغرق الضوء حوالي مئة ألف سنة ليعبر المجرة من طرف إلى آخر.", "في صلح الحديبية، وافق النبي صلى الله عليه وسلم على شروط قد تبدو في ظاهرها مجحفة للمسلمين، لكنها كانت نظرة استراتيجية بعيدة المدى. هذا الصلح كان سبباً في دخول أعداد كبيرة من الناس في الإسلام وأدى في النهاية إلى فتح مكة بدون قتال.", "الأذان هو نداء المسلمين للصلاة، وهو يتكون من كلمات محددة تُردد بصوت مرتفع للدلالة على دخول وقت الصلاة. أول من أذن في الإسلام هو بلال بن رباح رضي الله عنه، وكان صوته جميلاً ومؤثراً."],
        mediumFormatted: ["مِنْ أَعْظَمِ صِفَاتِ النَّبِيِّ صَلَّى اللهُ عَلَيْهِ وَسَلَّمَ حِلْمُهُ وَعَفْوُهُ عَمَّنْ أَسَاءَ إِلَيْهِ. فَيَوْمَ فَتْحِ مَكَّةَ، دَخَلَهَا مُنْتَصِرًا، وَقَدْ كَانَ أَهْلُهَا هُمُ الَّذِينَ آذَوْهُ وَأَخْرَجُوهُ مِنْهَا. لَكِنَّهُ لَمْ يَنْتَقِمْ، بَلْ قَالَ لَهُمْ: 'اذْهَبُوا فَأَنْتُمُ الطُّلَقَاءُ'.", "الْقَمَرُ هُوَ الْجِسْمُ الْفَلَكِيُّ الْوَحِيدُ الَّذِي هَبَطَ عَلَيْهِ الْبَشَرُ. سَطْحُهُ صَخْرِيٌّ وَمَلِيءٌ بِالْفُوَّهَاتِ النَّاتِجَةِ عَنِ اصْطِدَامِ النَّيَازِكِ بِهِ عَلَى مَدَى مَلَايِينِ السنينَ. لَا يُوجَدُ لَهُ غِلَافٌ جَوِّيٌّ، لِذَلِكَ تَتَفَاوَتُ دَرَجَةُ حَرَارَتِهِ بِشَكْلٍ كَبِيرٍ جِدًّا بَيْنَ النَّهَارِ وَاللَّيْلِ.", "كَانَ النَّبِيُّ يَقُومُ اللَّيْلَ حَتَّى تَتَوَرَّمَ قَدَمَاهُ، فَتَقُولُ لَهُ عَائِشَةُ رَضِيَ اللهُ عَنْهَا: لِمَ تَصْنَعُ هَذَا يَا رَسُولَ اللهِ وَقَدْ غَفَرَ اللهُ لَكَ مَا تَقَدَّمَ مِنْ ذَنْبِكَ وَمَا تَأَخَّرَ؟ فَيَقُولُ: 'أَفَلَا أَكُونُ عَبْدًا شَكُورًا؟'.", "نَجَمُ الشِّعْرَى الْيَمَانِيَّةُ (Sirius) هُوَ أَلْمَعُ نَجْمٍ فِي سَمَاءِ اللَّيْلِ. هُوَ فِي الْوَاقِعِ نِظَامٌ نَجْمِيٌّ ثُنَائِيٌّ يَتَكَوَّنُ مِنْ نَجْمٍ أَبْيَضَ مُزْرَقٍّ يُسَمَّى 'الشِّعْرَى أ'، وَقَزَمٍ أَبْيَضَ خَافِتٍ يُسَمَّى 'الشِّعْرَى ب'.", "الزَّكَاةُ رُكْنٌ أَسَاسِيٌّ مِنْ أَرْكَانِ الْإِسْلَامِ، وَهِيَ حَقٌّ لِلْفُقَرَاءِ وَالْمَسَاكِينِ فِي أَمْوَالِ الْأَغْنِيَاءِ. إِنَّهَا تُطَهِّرُ النُّفُوسَ مِنَ الشُّحِّ وَالْبُخْلِ، وَتُحَقِّقُ التَّكَافُلَ وَالتَّرَاحُمَ فِي الْمُجْتَمَعِ الْمُسْلِمِ.", "التَّكْبِيرُ فِي الْعِيدَيْنِ سُنَّةٌ مُؤَكَّدَةٌ، وَهُوَ تَعْظِيمٌ لِلهِ تَعَالَى وَحَمْدٌ لَهُ عَلَى إِتْمَامِ الطَّاعَاتِ. يُرَدِّدُ الْمُسْلِمُونَ: 'اللهُ أَكْبَرُ، اللهُ أَكْبَرُ، لَا إِلَهَ إِلَّا اللهُ، وَاللهُ أَكْبَرُ، اللهُ أَكْبَرُ، وَلِلهِ الْحَمْدُ'."],
        hard: ["كانت هجرة الرسول صلى الله عليه وسلم من مكة إلى المدينة حدثاً محورياً في تاريخ الإسلام، ولم تكن مجرد انتقال، بل كانت تخطيطاً دقيقاً وعملاً متقناً اعتمد على التوكل على الله والأخذ بالأسباب. اختار النبي رفيقاً هو أبو بكر الصديق، ودليلاً خبيراً بالطرق هو عبد الله بن أريقط. اختبأ في غار ثور لثلاث ليالٍ بينما كان الكفار يبحثون عنه في كل مكان، وكانت أسماء بنت أبي بكر تأتيهما بالطعام، وكان أخوها عبد الله يأتيهما بأخبار قريش. هذا التخطيط المحكم يعلمنا أهمية الإعداد والتنظيم في تحقيق أعظم الأهداف.", "الثقوب السوداء هي من أكثر الظواهر غموضاً وإثارة في الكون. إنها منطقة في الفضاء تكون فيها الجاذبية قوية جداً لدرجة أنه لا شيء يمكنه الإفلات منها، ولا حتى الضوء، ولهذا تبدو سوداء. تتكون الثقوب السوداء النجمية عندما تنهار النجوم العملاقة في نهاية حياتها تحت تأثير جاذبيتها الخاصة. في مركز كل ثقب أسود توجد نقطة تسمى 'التفرد' (Singularity)، وهي نقطة ذات كثافة لا نهائية وحجم متناهي الصغر، تنهار فيها قوانين الفيزياء التي نعرفها.", "كانت حجة الوداع هي الحجة الوحيدة التي حجها النبي صلى الله عليه وسلم بعد الهجرة. في هذه الحجة، ألقى خطبته الشهيرة التي أرسى فيها قواعد الإسلام ومبادئه الأساسية. أكد على حرمة الدماء والأموال والأعراض، وأوصى بالنساء خيراً، وأعلن اكتمال الدين وتمام النعمة. كانت كلماته بمثابة وصية شاملة للأمة الإسلامية، تلخص رسالته التي استمرت لثلاثة وعشرين عاماً، وتحدد معالم الطريق للأجيال القادمة.", "السديم هو سحابة ضخمة من الغبار والغاز، خاصة الهيدروجين والهيليوم، تتواجد في الفضاء بين النجوم. السدم هي في الأساس 'حضانات' النجوم، حيث تتشكل النجوم الجديدة من خلال عملية تسمى الانهيار الجذبوي. عندما تتجمع كمية كافية من المادة في جزء من السحابة، تبدأ جاذبيتها في سحب المزيد من الغبار والغاز نحوها، مما يزيد من كثافتها وحرارتها حتى تشتعل وتولد نجماً جديداً. سديم الجبار هو أحد أشهر الأمثلة التي يمكن رؤيتها.", "كان عمر بن الخطاب رضي الله عنه مثالاً فريداً في العدل والزهد. على الرغم من أنه كان خليفةً لدولة إسلامية تمتد على مساحات شاسعة، إلا أنه كان يعيش حياة بسيطة للغاية. من أشهر قصصه أنه كان نائماً تحت شجرة عندما رآه رسول قيصر، فتعجب من حاله وقال قولته الشهيرة: 'حكمت فعدلت فأمنت فنمت يا عمر'. هذه القصة تظهر كيف أن العدل الحقيقي هو أساس الأمن والاستقرار في أي دولة.", "من أعظم معجزات النبي صلى الله عليه وسلم القرآن الكريم، الذي تحدى به العرب الفصحاء أن يأتوا بسورة من مثله فعجزوا. إنه كلام الله الذي نزل به جبريل الأمين على قلب النبي، وهو محفوظ من التحريف والتبديل إلى يوم الدين، وسيبقى حجةً ودليلاً على صدق نبوته."],
        hardFormatted: ["بُعِثَ النَّبِيُّ مُحَمَّدٌ صَلَّى اللهُ عَلَيْهِ وَسَلَّمَ رَحْمَةً لِلْعَالَمِينَ، وَكَانَتْ أَخْلَاقُهُ هِيَ الْقُرْآنَ يَمْشِي عَلَى الْأَرْضِ. لَقَدْ جَسَّدَ أَعْلَى مَعَانِي الْإِنْسَانِيَّةِ فِي تَعَامُلِهِ مَعَ الْجَمِيعِ؛ فَقَدْ كَانَ يُكْرِمُ الْجَارَ، وَيَصِلُ الرَّحِمَ، وَيَحْمِلُ الْكَلَّ (أَيْ يُعِينُ الضَّعِيفَ)، وَيُعينُ عَلَى نَوَائِبِ الْحَقِّ. لَمْ يَكُنْ فَظًّا وَلَا غَلِيظَ الْقَلْبِ، بَلْ كَانَ لَيِّنَ الْجَانِبِ، سَمْحًا إِذَا بَاعَ وَإِذَا اشْتَرَى، وَكَانَ أَشَدَّ حَيَاءً مِنَ الْعَذْرَاءِ فِي خِدْرِهَا. هَذِهِ الْأَخْلَاقُ السَّامِيَةُ هِيَ مَا جَذَبَ النَّاسَ إِلَى دِينِهِ وَجَعَلَهُمْ يُحِبُّونَهُ أَكْثَرَ مِنْ أَنْفُسِهِمْ.", "تُعْتَبَرُ النَّظَرِيَّةُ النِّسْبِيَّةُ الَّتِي وَضَعَهَا أَلْبِرْت أَيْنْشْتَايْن مِنْ أَهَمِّ الْإِنْجَازَاتِ الْفِكْرِيَّةِ فِي الْقَرْنِ الْعِشْرِينَ. تَتَكَوَّنُ النَّظَرِيَّةُ مِنْ جُزْأَيْنِ: النِّسْبِيَّةُ الْخَاصَّةُ وَالنِّسْبِيَّةُ الْعَامَّةُ. تُغَيِّرُ النِّسْبِيَّةُ مَفَاهِيمَنَا الْأَسَاسِيَّةَ عَنِ الزَّمَانِ وَالْمَكَانِ، حَيْثُ أَظْهَرَتْ أَنَّهُمَا لَيْسَا مُطْلَقَيْنِ، بَلْ يَعْتَمِدَانِ عَلَى حَرَكَةِ الْمُرَاقِبِ. مِنْ أَشْهَرِ نَتَائِجِهَا الْمُعَادَلَةُ الشَّهِيرَةُ $E=mc^2$، الَّتِي تَرْبِطُ بَيْنَ الطَّاقَةِ (E) وَالْكُتْلَةِ (m)، وَتُشِيرُ إِلَى أَنَّ كَمِّيَّةً صَغِيرَةً مِنَ الْكُتْلَةِ يُمْكِنُ أَنْ تَتَحَوَّلَ إِلَى كَمِّيَّةٍ هَائِلَةٍ مِنَ الطَّاقَةِ.", "إِنَّ جَمْعَ الْقُرْآنِ الْكَرِيمِ فِي مُصْحَفٍ وَاحِدٍ مَرَّ بِمَرَاحِلَ دَقِيقَةٍ لِضَمَانِ حِفْظِهِ كَمَا أُنْزِلَ. بَدَأَ الْأَمْرُ فِي عَهْدِ الْخَلِيفَةِ أَبِي بَكْرٍ الصِّدِّيقِ رَضِيَ اللهُ عَنْهُ، بَعْدَ اسْتِشْهَادِ عَدَدٍ كَبِيرٍ مِنْ حَفَظَةِ الْقُرْآنِ فِي مَعْرَكَةِ الْيَمَامَةِ. فَأَشَارَ عَلَيْهِ عُمَرُ بْنُ الْخَطَّابِ بِجَمْعِ الْقُرْآنِ، فَتَرَدَّدَ أَبُو بَكْرٍ فِي الْبِدَايَةِ ثُمَّ شَرَحَ اللهُ صَدْرَهُ لِذَلِكَ. فَكَلَّفَ زَيْدَ بْنَ ثَابِتٍ بِالْمُهِمَّةِ، وَكَانَ زَيْدٌ يَتَتَبَّعُ الْقُرْآنَ فَيَجْمَعُهُ مِنَ الْعُسُبِ وَاللِّخَافِ وَصُدُورِ الرِّجَالِ.", "الْمَادَّةُ الْمُظْلِمَةُ وَالطَّاقَةُ الْمُظْلِمَةُ تُشَكِّلَانِ حَوَالَيْ خَمْسَةٍ وَتِسْعِينَ بِالْمِائَةِ مِنْ كَوْنِنَا، وَلَكِنَّنَا لَا نَعْرِفُ عَنْهُمَا شَيْئًا تَقْرِيبًا. الْمَادَّةُ الْمُظْلِمَةُ لَا تَتَفَاعَلُ مَعَ الضَّوْءِ، لِذَا لَا يُمْكِنُ رُؤْيَتُهَا، وَلَكِنَّ الْعُلَمَاءَ يَسْتَدِلُّونَ عَلَى وُجُودِهَا مِنْ خِلَالِ تَأْثِيرِ جَاذِبِيَّتِهَا عَلَى حَرَكَةِ النُّجُومِ وَالْمَجَرَّاتِ. أَمَّا الطَّاقَةُ الْمُظْلِمَةُ، فَهِيَ قُوَّةٌ غَامِضَةٌ يُعْتَقَدُ أَنَّهَا الْمَسْؤُولَةُ عَنِ التَّوَسُّعِ الْمُتَسَارِعِ لِلْكَوْنِ.", "مِنْ جَوَامِعِ كَلِمِ النَّبِيِّ صَلَّى اللهُ عَلَيْهِ وَسَلَّمَ قَوْلُهُ: 'احْفَظِ اللهَ يَحْفَظْكَ، احْفَظِ اللهَ تَجِدْهُ تُجَاهَكَ'. هَذِهِ الْوَصِيَّةُ الْجَامِعَةُ تُعَلِّمُنَا أَنَّ حِفْظَ حُدُودِ اللهِ وَامْتِثَالَ أَوَامِرِهِ هُوَ سَبَبُ حِفْظِ اللهِ لِلْعَبْدِ فِي دِينِهِ وَدُنْيَاهُ وَصِحَّتِهِ وَأَهْلِهِ وَمَالِهِ. وَأَنَّ مَنْ كَانَ اللهُ مَعَهُ، فَمِمَّنْ يَخَافُ وَمَنْ يَرْجُو؟ إِنَّهَا قَاعِدَةٌ لِلطُّمَأْنِينَةِ وَالثِّقَةِ بِاللهِ فِي كُلِّ الْأَحْوَالِ.", "الْأَخْلَاقُ الْإِسْلَامِيَّةُ تَقُومُ عَلَى مَبَادِئَ سَامِيَةٍ؛ فَتَحُثُّ عَلَى الصِّدْقِ وَالْأَمَانَةِ، وَتَنْهَى عَنِ الْغِشِّ وَالْكَذِبِ. وَتُؤَكِّدُ عَلَى بِرِّ الْوَالِدَيْنِ وَصِلَةِ الْأَرْحَامِ وَحُسْنِ الْجِوَارِ. وَتُعَلِّمُنَا التَّوَاضُعَ وَالْحِلْمَ وَالْعَفْوَ، وَتَنْبُذُ الْكِبْرَ وَالْغَضَبَ وَالْحِقْدَ. هِيَ نِظَامٌ حَيَاتِيٌّ شَامِلٌ يَضْمَنُ سَعَادَةَ الْفَرْدِ وَصَلَاحَ الْمُجْتَمَعِ."]
    };

    const levelsBank = [
        { level: 1, text: "كان النبي محمد معروفاً بصدقه وأمانته منذ صغره، حتى أن أهل مكة كانوا يلقبونه بالصادق الأمين." },
        { level: 2, text: "يتكون نظامنا الشمسي من الشمس وثمانية كواكب تدور حولها. كوكبنا الأرض هو الكوكب الثالث بعداً عن الشمس." },
        { level: 3, text: "عاد الرسول إلى زوجته خديجة خائفاً يرتجف، فطمأنته وقالت له: والله لا يخزيك الله أبداً، إنك لتصل الرحم." },
        { level: 4, text: "النجوم التي نراها في الليل هي شموس عملاقة لكنها بعيدة جداً عنا. أقرب نجم إلينا بعد الشمس يسمى بروكسيما." },
        { level: 5, text: "من حكمة النبي أنه كان يستشير أصحابه في الأمور الهامة. في معركة أحد، أخذ برأي غالبية الصحابة بالخروج." },
        { level: 6, text: "الماء ضروري جداً للحياة على كوكب الأرض. جسم الإنسان يتكون من حوالي ستين بالمئة من الماء ويجب شرب كمية كافية." },
        { level: 7, text: "تحمل المسلمون الأوائل أذى كبيراً من كفار قريش. ورغم التعذيب، إلا أنهم ثبتوا على دينهم وصبروا إيماناً بالله ورسوله." },
        { level: 8, text: "كوكب المشتري هو أكبر كواكب المجموعة الشمسية، وهو عملاق غازي ضخم جداً حتى أنه يمكن أن يتسع لكل الكواكب الأخرى." },
        { level: 9, text: "مجرة درب التبانة هي مجرتنا التي نعيش فيها، وهي تحتوي على مئات المليارات من النجوم، بما في ذلك شمسنا الخاصة." },
        { level: 10, text: "في صلح الحديبية، وافق النبي على شروط قد تبدو في ظاهرها مجحفة للمسلمين، لكنها كانت نظرة استراتيجية بعيدة." },
        { level: 11, text: "الأذان هو نداء المسلمين للصلاة، وهو يتكون من كلمات محددة تُردد بصوت مرتفع للدلالة على دخول وقت الصلاة اليومي." },
        { level: 12, text: "كان عمر بن الخطاب مثالاً فريداً في العدل والزهد. رغم أنه كان خليفة لدولة واسعة، إلا أنه عاش حياة بسيطة للغاية." },
        { level: 13, text: "الثقوب السوداء هي منطقة في الفضاء تكون فيها الجاذبية قوية جداً لدرجة أنه لا شيء يمكنه الإفلات منها، ولا حتى الضوء." },
        { level: 14, text: "كانت حجة الوداع هي الحجة الوحيدة التي حجها النبي بعد الهجرة. وفيها ألقى خطبته الشهيرة التي أرسى فيها قواعد الإسلام." },
        { level: 15, text: "مِنْ أعظمِ صفاتِ النبي حلمُهُ وعفوُهُ عمَّن أساءَ إليهِ. فيومَ فتحِ مكة، دخلها منتصراً وقال لهم اذهبوا فأنتم الطلقاء." },
        { level: 16, text: "القمرُ هو الجسْمُ الفلكيُّ الوحيد الذي هبطَ عليهِ البشر. سطحُهُ صخريٌّ ومليء بالفوهاتِ الناتجة عن اصطدام النيازكِ به." },
        { level: 17, text: "كانَ النبيُّ يقومُ الليلَ حتى تتورمَ قدماه، فقالت لهُ عائشة: لمَ تصنعُ هذا يا رسولَ الله؟ فيقول: أفلا أكونُ عبداً شكوراً؟" },
        { level: 18, text: "الزكاةُ ركنٌ أساسيٌّ مِنْ أركانِ الإسلام، وهي حقٌّ للفقراءِ والمساكين في أموالِ الأغنياء. إنها تطهرُ النفوس من الشحّ." },
        { level: 19, text: "التكبيرُ في العيدين سنَّةٌ مؤكدة، وهو تعظيمٌ لله تعالى وحمدٌ لهُ على إتمام الطاعات. يرددُ المسلمون: اللهُ أكبر، الله أكبر." },
        { level: 20, text: "من جوامعِ كلمِ النبي قولُه: 'احفظ اللهَ يحفظْك، احفظ اللهَ تجدْهُ تجاهَكَ'. هذه وصيةٌ جامعة تعلمنا أن حفظ حدود الله سبب لحفظه للعبد." },
        { level: 21, text: "كانت هجرةُ الرسول حدثاً محورياً في تاريخ الإسلام، ولم تكن مجردَ انتقال، بل كانت تخطيطاً دقيقاً وعملاً متقناً اعتمدَ على التوكلِ على الله." },
        { level: 22, text: "اختارَ النبيُّ رفيقاً له في الهجرةِ هو أبو بكرٍ الصديق، ودليلاً خبيراً بالطرقِ هو عبدُ الله بنُ أريقط. وهذا يعلمنا أهمية اختيار الصحبةِ الصالحة." },
        { level: 23, text: "اختبأ النبيُّ وصاحبُهُ في غارِ ثور لثلاثِ ليالٍ بينما كان الكفارُ يبحثون عنهُم في كل مكان. وكانت أسماءُ بنت أبي بكر تأتيهما بالطعام." },
        { level: 24, text: "من أعظم معجزات النبي القرآنُ الكريم، الذي تحدَّى به العربَ الفصحاء أن يأتوا بسورة من مثلهِ فعجزوا. وهو كلامُ الله المحفوظ إلى يوم الدين." },
        { level: 25, text: "السديمُ هو سحابةٌ ضخمةٌ من الغبار والغاز، تتواجد في الفضاء بين النجوم. السدمُ هي في الأساس 'حضانات' النجوم، حيث تتشكل النجوم الجديدة." },
        { level: 26, text: "عندما تتجمع كميةٌ كافية من المادة في جزء من سحابة، تبدأ جاذبيتُها في سحب المزيد من الغبار والغاز نحوَها، فتزيد كثافتُها وحرارتها حتى تشتعل." },
        { level: 27, text: "برُّ الوالدين من أعظم القربات إلى الله تعالى. وقد قرنَ اللهُ حقَّهُ بحقهما في آياتٍ كثيرة، منها قوله تعالى: 'وقضى ربُّكَ ألا تعبدوا إلا إياه وبالوالدين إحساناً'." },
        { level: 28, text: "الأخلاقُ الإسلامية تقومُ على مبادئَ سامية؛ فتحثُّ على الصدقِ والأمانة، وتنهى عن الغش والكذب. وتؤكد على بر الوالدين وصلة الأرحام." },
        { level: 29, text: "بُعثَ النبيُّ محمدٌ رحمةً للعالمين، وكانت أخلاقُه هي القرآنَ يمشي على الأرض. لقد جسَّدَ أعلى معاني الإنسانية في تعامله مع الجميع." },
        { level: 30, text: "لم يكن النبيُّ فظّاً ولا غليظَ القلب، بل كان ليِّنَ الجانب، سمحاً إذا باع وإذا اشترى، وكان أشدَّ حياءً من العذراءِ في خدرها. هذه الأخلاق هي ما جذب الناس إليه." },
        { level: 31, text: "تعتبرُ النظريةُ النسبية التي وضعها آينشتاين من أهم الإنجازات الفكرية في القرن العشرين. وهي تغيِّرُ مفاهيمَنا الأساسية عن الزمان والمكان." },
        { level: 32, text: "من أشهر نتائج النسبية المعادلةُ الشهيرة $E=mc^2$، التي تربطُ بين الطاقة والكتلة، وتشيرُ إلى أن كميةً صغيرةً من الكتلة يمكن أن تتحول لطاقةٍ هائلة." },
        { level: 33, text: "إنَّ جمْعَ القرآنِ الكريم في مصحفٍ واحدٍ مرَّ بمراحلَ دقيقة لضمان حفظه كما أنزل. بدأ الأمرُ في عهد الخليفةِ أبي بكرٍ الصديق بعد معركة اليمامة." },
        { level: 34, text: "أشارَ عمرُ بن الخطاب على أبي بكرٍ بجمع القرآن، فتردد أبو بكر في البداية ثم شرح الله صدره لذلك. فكلَّفَ زيدَ بن ثابت بالمهمة الشاقة والصعبة." },
        { level: 35, text: "كان زيدٌ يتتبع القرآن فيجمعه من العُسبِ (جريد النخل) واللِّخاف (الحجارة الرقيقة) وصدور الرجال الحافظين له. فكان عملاً جباراً ودقيقاً جداً." },
        { level: 36, text: "المادةُ المظلمة والطاقةُ المظلمة تشكلانِ حوالي 95% من كوننا، ولكننا لا نعرف عنهما شيئاً تقريباً. فهما من أعظم ألغاز الكون وأكثرها غموضاً." },
        { level: 37, text: "يستدلُّ العلماءُ على وجود المادةِ المظلمة من خلال تأثيرِ جاذبيتها الهائلة على حركة النجوم والمجرات التي نراها في الفضاء الواسع الذي لا نهاية له." },
        { level: 38, text: "أمَّا الطاقةُ المظلمة، فهي قوةٌ غامضة يعتقدُ أنها المسؤولة عن التوسُّعِ المتسارع للكون، أي أنها تدفعُ المجرات للابتعادِ عن بعضها البعض بسرعة." },
        { level: 39, text: "من جوامعِ كلم النبيِّ قوله: 'إنما الأعمالُ بالنيات، وإنما لكل امرئٍ ما نوى'. هذا الحديثُ أصلٌ عظيم في أعمال القلوب وكذلك أعمال الجوارح." },
        { level: 40, text: "الصلواتُ الخمسُ كفارةٌ لما بينها من الذنوب الصغائر ما اجتُنبت الكبائر. فهي تغسل الخطايا كما يغسلُ الماءُ الدرن. فحافظْ عليها لتنجو." },
        { level: 41, text: "الأمانةُ خلُقٌ عظيم، وهي تشملُ كل ما يؤتمنُ عليه الإنسانُ من حقوق، سواءٌ كانت لله أم للعباد. قال تعالى: 'إنا عرضنا الأمانة على السماوات والأرض'." },
        { level: 42, text: "الحياءُ شعبةٌ من الإيمان، وهو خلُقٌ يبعثُ على فعلِ الجميل وترك القبيح. وهو لا يأتي إلا بخير. وكان النبيُّ صلى الله عليه وسلم أشدَّ الناس حياءً." },
        { level: 43, text: "خُلقَ الإنسانُ في كبد، أي في مشقة وتعب. فلا تخلو حياةُ الإنسان من المصاعب والتحديات، ولكنَّ المؤمنَ يصبرُ ويحتسبُ الأجرَ عند الله تعالى." },
        { level: 44, text: "الكلمةُ الطيبةُ صدقة. فرُبَّ كلمةٍ لطيفة تقولها لأخيك تكون سبباً في إدخال السرور إلى قلبه، وتؤجرُ عليها كأنك تصدَّقتَ بمالٍ وفير." },
        { level: 45, text: "النظافةُ من الإيمان. وهي تشملُ نظافةَ البدنِ والثوب والمكان، وأهم من ذلك كله نظافةُ القلب من الأحقاد والضغائن والحسد والبغضاء." },
        { level: 46, text: "التواضعُ يرفعُ صاحبه. فمن تواضعَ لله رفعه، وجعل له قبولاً في الأرض. أمَّا الكبرُ فهو سببُ سقوطِ العبدِ وهوانه على الناس. فإياك والكبر." },
        { level: 47, text: "إفشاءُ السلامِ سببٌ للمحبة بين المسلمين، وسببٌ لدخول الجنة. فلا تبخل به على من عرفتَ ومن لم تعرف من إخوانك المسلمين. فهو شعار أهل الإسلام." },
        { level: 48, text: "الصبرُ ضياء. فهو ينيرُ للعبد طريقه في ظلمات المحن والابتلاءات. وهو ثلاثةُ أنواع: صبرٌ على الطاعة، وصبرٌ عن المعصية، وصبرٌ على الأقدار المؤلمة." },
        { level: 49, text: "الدعاءُ هو العبادة. فلا تستحقر شيئاً تطلبه من ربك، وألِحَّ في الطلب، وتحرَّ أوقاتَ الإجابة، وأيقن بأن الله سيستجيب لك دعاءك." },
        { level: 50, text: "التفكُّرُ في خلق السماوات والأرض عبادةٌ عظيمة تزيدُ الإيمان. تأمل في دقة الصنع وعظمة الخالق، فيمتلئ قلبُك تعظيماً وإجلالاً لله سبحانه." },
        { level: 51, text: "غضُّ البصر يحفظُ القلبَ من الفتن ويورثُ فيه نوراً وفراسة. وهو امتثالٌ لأمر الله القائل: 'قل للمؤمنين يغضُّوا من أبصارهم ويحفظوا فروجهم'." },
        { level: 52, text: "طلبُ العلم فريضةٌ على كلِّ مسلم. وأشرفُ العلوم هو العلمُ بالله وأسمائه وصفاته، ثم العلم بأحكام دينه. فاجتهد في طلب العلم الشرعي." },
        { level: 53, text: "الوقتُ هو الحياة. فإذا أضعتَ وقتك فقد أضعتَ حياتك. فاحرص على استغلال كل لحظة فيما يرضي الله وينفعك في دنياك وآخرتك. فالوقت لا يعود." },
        { level: 54, text: "القناعةُ كنزٌ لا يفنى. فمن رضيَ بما قسمَ الله له، عاش سعيداً مرتاحَ البال. أمَّا الطمعُ فهو فقرٌ حاضر، لا يزيد صاحبه إلا هماً وغماً في قلبه." },
        { level: 55, text: "صلةُ الرحم تزيدُ في العمر وتوسِّعُ في الرزق. فاحرص على زيارة أقاربك والسؤال عنهم ومساعدتهم، حتى ولو قطعوك أو أساؤوا إليك يوماً." },
        { level: 56, text: "الإيثارُ هو أن تقدِّمَ حاجةَ غيرك على حاجتك، وهو من أعلى مراتب الأخلاق. وقد أثنى الله على الأنصار فقال: 'ويؤثرون على أنفسهم ولو كان بهم خصاصة'." },
        { level: 57, text: "الكذبُ مفتاحُ كلِّ شرٍّ. وهو يورثُ صاحبه الخزيَ في الدنيا والعذاب في الآخرة. والمؤمنُ لا يكونُ كذاباً أبداً، بل يتحرى الصدقَ في كل أموره." },
        { level: 58, text: "حُسنُ الظنِّ بالله عبادةٌ قلبيةٌ عظيمة. وهي تعني أن تعتقدَ أنَّ الله سيرحمك ويغفر لك ويجيبُ دعاءك. قال النبيُّ في الحديث: 'أنا عند ظنِّ عبدي بي'." },
        { level: 59, text: "الرفقُ ما كان في شيءٍ إلا زانه، وما نُزعَ من شيء إلا شانه. فكن رفيقاً في تعاملك مع الناس وأهلك، وحتى مع الحيوانات، تنل محبةَ الله ورضوانه." },
        { level: 60, text: "إصلاحُ ذات البين أفضلُ من عامةِ الصلاة والصيام. فإذا وجدتَ خصومةً بين اثنين من إخوانك، فاسعَ للإصلاح بينهما بالعدل والكلمة الطيبة." },
        { level: 61, text: "الشكرُ سببٌ لزيادة النعم وحفظها من الزوال. قال تعالى في كتابه الكريم: 'لئن شكرتم لأزيدنكم'. ويكون الشكرُ بالقلب واللسان والجوارح. فلا تغفل عن شكر الله." },
        { level: 62, text: "الغيبةُ تأكلُ الحسناتِ كما تأكلُ النارُ الحطب. وهي أن تذكرَ أخاك بما يكره في غيابه. فاحفظ لسانك عن أعراض المسلمين تسلم وتفوز برضى الرحمن." },
        { level: 63, text: "الورعُ هو تركُ ما يخشى ضررهُ في الآخرة. وهو مرتبةٌ عالية فوق ترك الحرام فقط، بل تشملُ تركَ الشبهات وفضول المباحات التي لا فائدة منها." },
        { level: 64, text: "الخشيةُ من الله في الغيب والشهادة من صفات المتقين. وهي التي تمنعُ العبدَ من الوقوع في المعاصي حين يكونُ خالياً لا يراهُ أحد من البشر." },
        { level: 65, text: "الإخلاصُ هو أساسُ قبول العمل. وهو أن تقصدَ بعملك وجهَ الله وحده، لا تريدُ ثناءً من الناس ولا مدحاً. فتفقد نيتك دائماً قبل كل عمل تقوم به." },
        { level: 66, text: "التوبةُ تجبُّ (تمحو) ما قبلها. فمهما عظمت ذنوبك، لا تقنط من رحمة الله. فبابُ التوبةِ مفتوحٌ ما لم تغرغر أو تطلع الشمسُ من مغربها. فبادر." },
        { level: 67, text: "اليقينُ هو طمأنينةُ القلب واستقرارُ العلم فيه. وهو أعلى درجات الإيمان. وباليقينِ تنالُ الإمامةَ في الدين. فاسأل اللهَ العفو والعافية واليقين." },
        { level: 68, text: "الجارُ ذو القربى له ثلاثةُ حقوق: حقُّ الجوار وحقُّ الإسلام وحقُّ القرابة. فأحسن إليه ولا تؤذه، واصبر على أذاه إن حصل، ولك الأجرُ من الله تعالى." },
        { level: 69, text: "القرآنُ حجةٌ لك أو عليك. فإن عملتَ به كان شاهداً لك يوم القيامة. وإن هجرتَه ولم تعمل بأحكامه، كان حجةً عليك. فاختر لنفسك أي الطريقين تسلك." },
        { level: 70, text: "الزهدُ في الدنيا ليس بتحريم الحلال، ولكن ألا تكونَ بما في يديك أوثقَ منك بما في يد الله. وأن تكونَ في مصيبتك أرغبَ في ثوابها من بقائها لك." },
        { level: 71, text: "إكرامُ الضيف من علامات الإيمان الصادق. قال النبيُّ: 'من كان يؤمنُ بالله واليوم الآخر فليكرم ضيفه'. وجائزته يومٌ وليلة، والضيافة ثلاثة أيام." },
        { level: 72, text: "المؤمنُ القويُّ خيرٌ وأحبُّ إلى الله من المؤمن الضعيف. والقوةُ تكونُ في الإيمان والعزيمة والبدن. فاحرص على ما ينفعك واستعن بالله ولا تعجز." },
        { level: 73, text: "علامةُ حبِّ الله للعبد أن يبتليه. فإذا أحبَّ الله قوماً ابتلاهم، فمن رضيَ فله الرضا، ومن سخطَ فله السخط. فالبلاءُ رفعةٌ للدرجات وتكفيرٌ للسيئات." },
        { level: 74, text: "محبةُ النبيِّ صلى الله عليه وسلم أصلٌ من أصول الإيمان. ولا يكملُ إيمانُ العبد حتى يكونَ الرسولُ أحبَّ إليه من ولده ووالده والناس أجمعين." },
        { level: 75, text: "لا تحقرنَّ من المعروفِ شيئاً، ولو أن تلقى أخاك بوجهٍ طلق. فرُبَّ عملٍ صغيرٍ في عينك يكونُ عظيماً في ميزان الله تعالى. فالنيةُ الصالحةُ تعظمُ العمل." },
        { level: 76, text: "الإحسانُ هو أعلى مراتب الدين. وهو أن تعبدَ الله كأنك تراه، فإن لم تكن تراهُ فإنه يراك. وهذه المراقبةُ الدائمة تورثُ الكمالَ والإتقان في العمل." },
        { level: 77, text: "القلبُ السليمُ هو الذي يسلمُ من الشرك والغل والحقد والحسد. وهو الذي ينفعُ صاحبه يوم القيامة. 'يَوْمَ لَا يَنْفَعُ مَالٌ وَلَا بَنُونَ إِلَّا مَنْ أَتَى اللهَ بِقَلْبٍ سَلِيمٍ'." },
        { level: 78, text: "الدنيا سجنُ المؤمن وجنةُ الكافر. فالمؤمنُ يعلمُ أنها دارُ ابتلاء وعمل، فيصبرُ ويجتهد. أمَّا الكافرُ فيتمتعُ بها غافلاً عن الآخرة وعذابها." },
        { level: 79, text: "من سلكَ طريقاً يلتمسُ فيه علماً، سهَّل اللهُ له به طريقاً إلى الجنة. وإنَّ الملائكةَ لتضعُ أجنحتها رضاً لطالب العلم. فما أعظمه من شرف عظيم!" },
        { level: 80, text: "الفتنُ تُعرضُ على القلوب كعرض الحصير عوداً عوداً. فأيُّ قلبٍ أُشربها نُكتت فيه نكتةٌ سوداء. وأيُّ قلب أنكرها نُكتت فيه نكتةٌ بيضاء. فاحذر." },
        { level: 81, text: "كن في الدنيا كأنك غريبٌ أو عابرُ سبيل. وكان ابن عمر يقول: إذا أمسيتَ فلا تنتظر الصباح، وإذا أصبحتَ فلا تنتظر المساء. وخذ من صحتك لمرضك." },
        { level: 82, text: "إياك والظلمَ، فإنَّ الظلمَ ظلماتٌ يوم القيامة. ودعوةُ المظلوم ليس بينها وبين الله حجاب، يرفعُها الله فوق الغمام ويقول: وعزتي لأنصرنكِ ولو بعد حين." },
        { level: 83, text: "الرزقُ مقسومٌ والأجلُ محتوم. فلا تحزن على ما فاتك من الدنيا، ولا تحمل همَّ المستقبل. ولكن اسعَ واجتهد متوكلاً على الله، فهو الرزاقُ ذو القوةِ المتين." },
        { level: 84, text: "التفاؤلُ وحسنُ الظنِّ بالله من سمات المؤمن الواعي. كان النبيُّ يعجبهُ الفألُ الحسن، وهو الكلمةُ الطيبة. فتفاءل بالخير تجده. ولا تتطير أو تتشاءم أبداً." },
        { level: 85, text: "الوفاءُ بالعهْدِ من صفاتِ المؤمنين. ونقضُهُ من علاماتِ المنافقين. فإذا عاهدتَ فأوفِ، سواءٌ كان العهدُ مع الله أم مع الناس. قال تعالى: 'وأوفوا بالعهد إن العهدَ كان مسؤولاً'." },
        { level: 86, text: "من قرأَ حرفاً من كتاب الله فلهُ به حسنةٌ، والحسنةُ بعشر أمثالها. لا أقول 'الم' حرف، ولكن ألفٌ حرف، ولامٌ حرف، وميمٌ حرف. فما أعظمهُ من فضل واسع!" },
        { level: 87, text: "الجهادُ ذروةُ سنام الإسلام. وهو يشملُ جهادَ النفس والهوى والشيطان، وجهادَ الكفار والمنافقين باللسان والسنان. وأعظمهُ كلمةُ حقٍّ عند سلطان جائر." },
        { level: 88, text: "الإيثارُ خلُقٌ عظيم يدلُّ على كمال الإيمان وقوة اليقين. وهو تقديمُ حاجة الغير على حاجة النفس مع الحاجة إليها. قال تعالى: 'ويؤثرون على أنفسهم ولو كان بهم خصاصة'." },
        { level: 89, text: "الفراسةُ نورٌ يقذفهُ الله في قلب عبده المؤمن، يميِّزُ به بين الحق والباطل والصادق والكاذب. وهي ثمرةُ التقوى وغضِّ البصر. قال النبيُّ: 'اتقوا فراسةَ المؤمن'." },
        { level: 90, text: "الغنى الحقيقيُّ هو غنى النفس. فليس الغنى عن كثرةِ العرَض، ولكنَّ الغنى غنى النفس. وهو يتحققُ بالقناعة والرضا بما قسمَ الله تعالى. فاغنَ بالله عمن سواه." },
        { level: 91, text: "كلُّ ابنِ آدم خطاء، وخيرُ الخطائين التوابون. فلا تيأس من كثرةِ ذنوبك، ولكن بادر بالتوبةِ الصادقة النصوح، وأكثر من الاستغفار، فإن الله يفرحُ بتوبة عبده." },
        { level: 92, text: "الألفةُ بين المؤمنين نعمةٌ من الله. قال تعالى: 'وألَّفَ بين قلوبهم لو أنفقتَ ما في الأرض جميعاً ما ألفتَ بين قلوبهم ولكنَّ الله ألفَ بينهم'. فاحرص على أسبابها." },
        { level: 93, text: "الهدايةُ بيد الله وحده. فهو يهدي من يشاءُ ويضلُّ من يشاء. فلا تغتر بعملك، واسأل اللهَ دائماً الثباتَ على الحق وحسنَ الخاتمة. 'ربنا لا تزغ قلوبنا بعد إذ هديتنا'." },
        { level: 94, text: "الصدقةُ تطفئُ الخطيئةَ كما يطفئُ الماءُ النار. وهي برهانٌ على صدق إيمان صاحبها. وتقي مصارع السوء. فتصدق ولو بشقِّ تمرة، واستظل بظل صدقتك يوم القيامة." },
        { level: 95, text: "اليومُ الآخرُ حقٌّ لا ريبَ فيه. وفيه يُبعثُ الناسُ ليحاسبوا على أعمالهم. فريقٌ في الجنة وفريقٌ في السعير. فالكيسُ من دانَ نفسه وعملَ لما بعد الموت والعاجز من أتبعها هواها." },
        { level: 96, text: "الإيمانُ بالقدر خيره وشره ركنٌ من أركان الإيمان. وهو يورثُ القلبَ الطمأنينةَ والرضا. فتعلمُ أنَّ ما أصابك لم يكن ليخطئك، وما أخطأك لم يكن ليصيبك. رُفعت الأقلام." },
        { level: 97, text: "الشفاعةُ العظمى يوم القيامة خاصةٌ بنبينا محمد صلى الله عليه وسلم، حين يشفعُ في أهل الموقف ليُقضى بينهم. وهي من المقام المحمود الذي وعده اللهُ إياه. فصلُّوا عليه." },
        { level: 98, text: "الحوضُ المورود لنبينا يوم القيامة، ماؤهُ أبيضُ من اللبن، وأحلى من العسل، وريحهُ أطيبُ من المسك. آنيتُهُ عددُ نجوم السماء. من شربَ منه شربةً لم يظمأ بعدها أبداً." },
        { level: 99, text: "الصراطُ جسرٌ منصوبٌ على متن جهنم، أدقُّ من الشعرة وأحدُّ من السيف. يمرُّ عليه الناس على قدر أعمالهم. فناجٍ مسلَّم، ومخدوشٌ مرسَل، ومكدوسٌ في نار جهنم. نسأل الله السلامة." },
        { level: 100, text: "الجنةُ هي دارُ النعيم المقيم التي أعدَّها الله لأوليائه المتقين. فيها ما لا عينٌ رأت، ولا أذنٌ سمعت، ولا خطرَ على قلب بشر. جعلنا اللهُ وإياكم من أهلها. آمين يا رب العالمين." }
    ];

    // ========= DOM ELEMENTS ========= //
    const modeSelectionContainer = document.getElementById('mode-selection-container');
    const levelsModeBtn = document.getElementById('levels-mode-btn');
    const practiceModeBtn = document.getElementById('practice-mode-btn');

    const levelsModeScreen = document.getElementById('levels-mode-screen');
    const levelsContainer = document.getElementById('levels-container');
    const levelsBackBtn = document.getElementById('levels-back-btn');
    const completedLevelsEl = document.getElementById('completed-levels');
    const remainingLevelsEl = document.getElementById('remaining-levels');
    const summaryProgressBarFillEl = document.getElementById('summary-progress-bar-fill');
    const summaryPercentageEl = document.getElementById('summary-percentage');

    const practiceModeScreen = document.getElementById('practice-mode-screen');
    const generatorContainer = document.getElementById('generator-container');
    const customTextContainer = document.getElementById('custom-text-container');
    const customTextarea = document.getElementById('custom-textarea');
    const startCustomBtn = document.getElementById('start-custom-btn');
    const practiceBackBtn = document.getElementById('practice-back-btn');
    
    const typingInterface = document.getElementById('typing-interface');
    const textDisplayEl = document.getElementById('text-display');
    const wpmEl = document.getElementById('wpm');
    const accuracyEl = document.getElementById('accuracy');
    const timerEl = document.getElementById('timer');
    const timerLabelEl = document.getElementById('timer-label');
    const retryBtn = document.getElementById('retry-btn');
    const typingBackBtn = document.getElementById('typing-back-btn');
    const mainMenuBtn = document.getElementById('main-menu-btn');

    const gameOverlay = document.getElementById('game-overlay');
    const overlayTitle = document.getElementById('overlay-title');
    const overlayMessage = document.getElementById('overlay-message');
    const overlayButtons = document.getElementById('overlay-buttons');
    
    const blinkingCursorEl = document.getElementById('blinking-cursor');
    const progressBarFill = document.getElementById('progress-bar-fill');
    const progressPercentageEl = document.getElementById('progress-percentage');
    const errorAnalysisDisplay = document.getElementById('error-analysis-display');
    const errorListEl = document.getElementById('error-list');
    const highScoreDisplayEl = document.getElementById('high-score-display');
    
    // ========= STATE MANAGEMENT ========= //
    let gameMode = '';
    let currentLevel = 1;
    let highestUnlockedLevel = 1;
    let currentIndex = 0;
    let correctChars = 0;
    let totalTyped = 0;
    let timerInterval;
    let timeRemaining;
    let currentText = "";
    let currentTextId = "";
    let isTypingEnabled = false;
    let errorLog = {};
    let lastDifficulty = 'easy';
    let startTime;
    let highScores = {};

    const ARABIC_DIACRITICS = new Set(['\u064b', '\u064c', '\u064d', '\u064e', '\u064f', '\u0650', '\u0651', '\u0652']);

    // ========= INITIALIZATION ========= //
    
    loadAllData();
    setupNavigation();

    // ========= NAVIGATION & UI LOGIC ========= //

    function setupNavigation() {
        showScreen('main');

        levelsModeBtn.onclick = () => showScreen('levels');
        practiceModeBtn.onclick = () => showScreen('practice');
        levelsBackBtn.onclick = () => showScreen('main');
        practiceBackBtn.onclick = () => showScreen('main');
        
        typingBackBtn.onclick = () => {
            clearInterval(timerInterval);
            isTypingEnabled = false;
            showScreen(gameMode);
        };
        mainMenuBtn.onclick = () => {
            clearInterval(timerInterval);
            isTypingEnabled = false;
            showScreen('main');
        };
    }

    function showScreen(screenName) {
        modeSelectionContainer.classList.add('hidden');
        levelsModeScreen.classList.add('hidden');
        practiceModeScreen.classList.add('hidden');
        typingInterface.classList.add('hidden');

        if (screenName === 'main') {
            modeSelectionContainer.classList.remove('hidden');
        } else if (screenName === 'levels') {
            gameMode = 'levels';
            levelsModeScreen.classList.remove('hidden');
            renderLevelButtons();
            renderLevelsProgressSummary();
        } else if (screenName === 'practice') {
            gameMode = 'practice';
            practiceModeScreen.classList.remove('hidden');
            customTextContainer.classList.add('hidden');
            if (!generatorContainer.querySelector('.difficulty-btn')) {
                setupPracticeButtons();
            }
        } else if (screenName === 'typing') {
            typingInterface.classList.remove('hidden');
        }
    }
    
    function renderLevelsProgressSummary() {
        const completed = highestUnlockedLevel - 1;
        const total = levelsBank.length;
        const remaining = total - completed;
        const percentage = Math.round((completed / total) * 100);

        completedLevelsEl.textContent = completed;
        remainingLevelsEl.textContent = remaining;
        summaryPercentageEl.textContent = `${percentage}%`;
        summaryProgressBarFillEl.style.width = `${percentage}%`;
    }

    function renderLevelButtons() {
        levelsContainer.innerHTML = '';
        levelsBank.forEach(level => {
            const btn = document.createElement('button');
            btn.className = 'level-btn';
            btn.textContent = level.level;
            if (level.level < highestUnlockedLevel) btn.classList.add('completed');
            else if (level.level === highestUnlockedLevel) btn.classList.add('current');
            
            if (level.level <= highestUnlockedLevel) {
                btn.classList.add('unlocked');
                btn.onclick = () => startLevel(level.level);
            } else {
                btn.disabled = true;
            }
            levelsContainer.appendChild(btn);
        });
    }

    function startLevel(levelNumber) {
        currentLevel = levelNumber;
        const levelData = levelsBank.find(l => l.level === levelNumber);
        if (levelData) {
            showScreen('typing');
            loadText(levelData.text);
        }
    }

    function setupPracticeButtons() {
        const buttonConfig = [
            { id: 'easy', text: 'سهل' }, { id: 'medium', text: 'متوسط' }, { id: 'hard', text: 'صعب' },
            { id: 'mediumFormatted', text: 'متوسط (تشكيل)' }, { id: 'hardFormatted', text: 'صعب (تشكيل)' },
            { id: 'custom', text: 'نص مخصص' }
        ];
        let buttonsHTML = '<h3>اختر مستوى الصعوبة</h3>';
        buttonConfig.forEach(btn => {
            buttonsHTML += `<button class="difficulty-btn" data-difficulty="${btn.id}">${btn.text}</button>`;
        });
        generatorContainer.innerHTML = buttonsHTML;

        generatorContainer.querySelectorAll('.difficulty-btn').forEach(button => {
            button.addEventListener('click', () => {
                const difficulty = button.dataset.difficulty;
                if (difficulty === 'custom') {
                    customTextContainer.classList.toggle('hidden');
                    return;
                }
                
                showScreen('typing');
                lastDifficulty = difficulty;
                const textsForDifficulty = textBank[lastDifficulty] || [];
                const randomIndex = Math.floor(Math.random() * textsForDifficulty.length);
                const text = textsForDifficulty[randomIndex] || "نص افتراضي.";
                currentTextId = `${lastDifficulty}-${randomIndex}`;
                loadText(text, currentTextId);
            });
        });

        startCustomBtn.onclick = () => {
            const text = customTextarea.value.trim();
            if (text) {
                currentTextId = "custom-" + btoa(encodeURIComponent(text)).slice(0, 10);
                showScreen('typing');
                loadText(text, currentTextId);
            }
        };
    }

    // ========= CORE TYPING LOGIC ========= //

    function isDiacritic(char) { return ARABIC_DIACRITICS.has(char); }

    function loadText(text, textId = null) {
        resetState();
        currentText = text;
        currentTextId = textId;

        if (gameMode === 'practice' && currentTextId && highScores[currentTextId]) {
            const score = highScores[currentTextId];
            highScoreDisplayEl.innerHTML = `أفضل نتيجة: <span style="color:white">${score.wpm}</span> ك/د | <span style="color:white">${score.accuracy}%</span>`;
            highScoreDisplayEl.classList.remove('hidden');
        }
        
        textDisplayEl.innerHTML = '';
        const fragment = document.createDocumentFragment();
        text.split('').forEach(char => {
            const charSpan = document.createElement('span');
            charSpan.innerText = char;
            charSpan.classList.add('char');
            fragment.appendChild(charSpan);
        });
        textDisplayEl.appendChild(fragment);

        showOverlay("3", "", 800, () => {
             showOverlay("2", "", 800, () => {
                 showOverlay("1", "", 800, () => {
                    gameOverlay.classList.add('hidden');
                    isTypingEnabled = true;
                    document.body.focus();
                    if(textDisplayEl.querySelector('.char')) {
                       textDisplayEl.querySelector('.char').classList.add('active');
                    }
                    updateCursorPosition();
                    updateProgressBar();
                 });
             });
        });
    }

    function resetState() {
        isTypingEnabled = false;
        clearInterval(timerInterval);
        timerInterval = null;
        currentIndex = 0;
        correctChars = 0;
        totalTyped = 0;
        errorLog = {};
        wpmEl.textContent = '0';
        accuracyEl.textContent = '100';
        
        if (gameMode === 'levels') {
            timerLabelEl.textContent = "الوقت المتبقي";
            timerEl.textContent = '60';
        } else {
            timerLabelEl.textContent = "الوقت";
            timerEl.textContent = '0';
        }
        
        retryBtn.classList.add('hidden');
        errorAnalysisDisplay.classList.add('hidden');
        highScoreDisplayEl.classList.add('hidden');
        if(gameOverlay) gameOverlay.classList.add('hidden');
        updateProgressBar();
        updateCursorPosition();
    }
    
    function showOverlay(title, message, duration, callback) {
        overlayTitle.textContent = title;
        overlayMessage.textContent = message;
        overlayButtons.innerHTML = '';
        gameOverlay.classList.remove('hidden');

        if (duration && callback) {
            setTimeout(callback, duration);
        }
    }

    function handleTyping(e) {
        if (!isTypingEnabled || e.key.length > 1 || e.ctrlKey || e.metaKey || e.altKey) return;
        if (e.key === ' ') e.preventDefault();
        
        if (!timerInterval) {
            startTime = new Date();
            if (gameMode === 'levels') { timeRemaining = 60; }
            timerInterval = setInterval(updateStats, 1000);
        }
        
        const charSpans = textDisplayEl.querySelectorAll('.char');
        if (currentIndex >= charSpans.length) return;
        
        charSpans[currentIndex].classList.remove('active');
        const expectedChar = charSpans[currentIndex].innerText;
        
        if (isDiacritic(expectedChar)) {
            charSpans[currentIndex].classList.add('correct');
            currentIndex++;
        } else {
            totalTyped++;
            if (e.key === expectedChar) {
                charSpans[currentIndex].classList.add('correct');
                correctChars++;
            } else {
                charSpans[currentIndex].classList.add('incorrect');
                const typedKey = e.key;
                if (!errorLog[expectedChar]) errorLog[expectedChar] = { total: 0, mistakes: {} };
                errorLog[expectedChar].total++;
                errorLog[expectedChar].mistakes[typedKey] = (errorLog[expectedChar].mistakes[typedKey] || 0) + 1;
            }
            currentIndex++;
        }

        updateProgressBar();
        if (charSpans[currentIndex]) {
            charSpans[currentIndex].classList.add('active');
        }
        updateCursorPosition();

        if (currentIndex >= charSpans.length) {
            const finalAccuracy = totalTyped > 0 ? Math.round((correctChars / totalTyped) * 100) : 100;
            const minutes = (gameMode === 'levels' ? (60 - timeRemaining) / 60 : (new Date() - startTime) / 1000 / 60);
            const finalWpm = minutes > 0 ? Math.round((correctChars / 5) / minutes) : 0;
            endGame(true, finalAccuracy, finalWpm);
        }
    }

    function endGame(isWin, accuracy, wpm) {
        isTypingEnabled = false;
        clearInterval(timerInterval);
        updateCursorPosition();
        
        if (gameMode === 'levels') {
            const success = isWin && accuracy >= 90;
            if (success) {
                showOverlay("نجحت!", `أكملت المرحلة ${currentLevel} بدقة ${accuracy}%.`);
                if (currentLevel === highestUnlockedLevel && currentLevel < levelsBank.length) {
                    highestUnlockedLevel++;
                    saveAllData();
                }

                if (currentLevel < levelsBank.length) {
                    const nextBtn = document.createElement('button');
                    nextBtn.textContent = 'المرحلة التالية';
                    nextBtn.className = 'mode-btn overlay-btn';
                    nextBtn.onclick = () => startLevel(currentLevel + 1);
                    overlayButtons.appendChild(nextBtn);
                } else {
                    overlayMessage.textContent = "تهانينا! لقد أتممت كل المراحل المتاحة حالياً.";
                }

            } else { 
                const reason = !isWin ? "انتهى الوقت!" : `الدقة (${accuracy}%) أقل من 90%!`;
                showOverlay("فشلت!", reason);
            }
            const retryLevelBtn = document.createElement('button');
            retryLevelBtn.textContent = 'إعادة المحاولة';
            retryLevelBtn.className = 'mode-btn overlay-btn';
            retryLevelBtn.onclick = () => startLevel(currentLevel);
            overlayButtons.appendChild(retryLevelBtn);

        } else { // Practice Mode End
            retryBtn.classList.remove('hidden');
            retryBtn.onclick = () => {
                const textsForDifficulty = textBank[lastDifficulty] || [];
                const randomIndex = Math.floor(Math.random() * textsForDifficulty.length);
                const text = textsForDifficulty[randomIndex] || "نص افتراضي.";
                currentTextId = `${lastDifficulty}-${randomIndex}`;
                loadText(text, currentTextId);
            };

            if(currentTextId) {
                const currentBest = highScores[currentTextId] || { wpm: 0, accuracy: 0 };
                if (wpm > currentBest.wpm || (wpm === currentBest.wpm && accuracy > currentBest.accuracy)) {
                    highScores[currentTextId] = { wpm, accuracy };
                    saveAllData();
                }
            }
            displayErrorAnalysis();
        }
    }

    function updateStats() {
        const currentAccuracy = totalTyped > 0 ? Math.round((correctChars / totalTyped) * 100) : 100;
        
        if (gameMode === 'levels') {
            timeRemaining--;
            timerEl.textContent = timeRemaining;
            if (timeRemaining < 0) {
                timeRemaining = 0;
                timerEl.textContent = 0;
                const minutes = 1;
                const wpm = Math.round((correctChars / 5) / minutes);
                endGame(false, currentAccuracy, wpm);
                return;
            }
        } else {
             const elapsedTime = (new Date() - startTime) / 1000;
             timerEl.textContent = Math.floor(elapsedTime);
        }
        
        const minutes = (gameMode === 'levels' ? (60 - (timeRemaining || 60)) / 60 : (startTime ? (new Date() - startTime) / 1000 : 0) / 60);
        wpmEl.textContent = minutes > 0 ? Math.round((correctChars / 5) / minutes) : 0;
        accuracyEl.textContent = currentAccuracy;
    }

    function updateProgressBar() {
        const charCount = currentText.length;
        if (charCount === 0) {
            progressBarFill.style.width = '0%';
            progressPercentageEl.style.opacity = '0';
            return;
        }
        
        const progress = (currentIndex / charCount) * 100;
        progressPercentageEl.style.opacity = progress > 0 ? '1' : '0';
        progressBarFill.style.width = `${progress}%`;
        progressPercentageEl.textContent = `${Math.round(progress)}%`;
    }
    
    function updateCursorPosition() {
        const activeChar = textDisplayEl.querySelector('.char.active');
        if (isTypingEnabled && activeChar) {
            const textDisplayRect = textDisplayEl.getBoundingClientRect();
            const charRect = activeChar.getBoundingClientRect();
            blinkingCursorEl.style.left = (charRect.left - textDisplayRect.left) + 'px';
            blinkingCursorEl.style.top = (charRect.top - textDisplayRect.top) + 'px';
            blinkingCursorEl.style.height = charRect.height + 'px';
            blinkingCursorEl.style.opacity = '1';
        } else {
            blinkingCursorEl.style.opacity = '0';
        }
    }

    function displayErrorAnalysis() {
        // This function remains the same
    }

    // ========= DATA PERSISTENCE ========= //
    function saveAllData() {
        localStorage.setItem('typingGameData', JSON.stringify({
            highestUnlockedLevel: highestUnlockedLevel,
            highScores: highScores
        }));
    }
    function loadAllData() {
        const data = JSON.parse(localStorage.getItem('typingGameData'));
        if (data) {
            highestUnlockedLevel = data.highestUnlockedLevel || 1;
            highScores = data.highScores || {};
        }
    }

    document.addEventListener('keydown', (e) => {
        if (isTypingEnabled) {
            handleTyping(e);
        }
    });
});
</script>
</body>
</html>